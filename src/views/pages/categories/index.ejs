<%- include('../../components/head', { page: { title: 'Категории' } }) %>
<%- include('../../components/navbar') %>

<main class="bg-slate-50">
  <section class="container mx-auto max-w-6xl px-4 py-12 space-y-8">
    <div class="flex items-center justify-between gap-4">
      <div>
        <p class="text-sm text-slate-500">Управление подборками новостей</p>
        <h1 class="text-3xl font-bold text-slate-900">Категории</h1>
      </div>
      <% if (isAdmin) { %>
        <a
          href="/categories/create"
          class="inline-flex items-center gap-2 rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-slate-800"
        >
          <span class="text-lg leading-none">+</span>
          <span>Создать категорию</span>
        </a>
      <% } %>
    </div>

    <% if (messages.success.length) { %>
      <% messages.success.forEach(function(msg) { %>
        <div class="rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-emerald-900">
          <%= msg %>
        </div>
      <% }) %>
    <% } %>
    <% if (messages.error.length) { %>
      <% messages.error.forEach(function(msg) { %>
        <div class="rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-red-900">
          <%= msg %>
        </div>
      <% }) %>
    <% } %>

    <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm">
      <div class="grid grid-cols-12 bg-slate-50 px-4 py-2 text-sm font-semibold text-slate-600">
        <div class="col-span-3">Название</div>
        <div class="col-span-7">Описание</div>
        <div class="col-span-2 text-right">Действия</div>
      </div>
      <% if (categories.length === 0) { %>
        <div class="px-4 py-6 text-slate-600">Категорий пока нет.</div>
      <% } %>
      <% categories.forEach(function(category) { %>
        <% const isSubscribed = (subscribedIds || []).includes(category.id) %>
        <div class="grid grid-cols-12 border-t border-slate-200 px-4 py-3 items-center">
          <div class="col-span-3 font-medium text-slate-900"><%= category.name %></div>
          <div class="col-span-7 text-slate-700"><%= category.description %></div>
          <div class="col-span-2 flex justify-end">
            <% if (isAdmin) { %>
              <div class="flex items-center gap-3 text-sm">
                <a href="/categories/<%= category.id %>/edit" class="text-slate-900 hover:underline">Редактировать</a>
                <form action="/categories/<%= category.id %>/delete" method="post" onsubmit="return confirm('Удалить категорию?');">
                  <button type="submit" class="text-red-700 hover:underline cursor-pointer">Удалить</button>
                </form>
              </div>
            <% } else { %>
              <form action="/categories/<%= category.id %>/<%= isSubscribed ? 'unsubscribe' : 'subscribe' %>" method="post">
                <button type="submit" class="rounded-lg border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-900 hover:bg-slate-100 cursor-pointer">
                  <%= isSubscribed ? 'Отписаться' : 'Подписаться' %>
                </button>
              </form>
            <% } %>
          </div>
        </div>
      <% }) %>
    </div>
  </section>
</main>
<%- include('../../components/footer') %>
